/*! SCEditor v1.4.7 | (C) 2015, Sam Clarke | sceditor.com/license */!function(a){"use strict";a.sceditor.plugins.undo=function(){var b,d,a=this,c=0,e=50,f=[],g=[],h=!1,i=function(a){h=!0,d=a.value,b.sourceMode(a.sourceMode),b.val(a.value,!1),b.focus(),a.sourceMode?b.sourceEditorCaret(a.caret):b.getRangeHelper().restoreRange(),h=!1},j=function(a,b){var c,d,e,f,g=a.length,h=b.length,i=Math.max(g,h);for(c=0;i>c&&a.charAt(c)===b.charAt(c);c++);for(e=h>g?h-g:0,f=g>h?g-h:0,d=i-1;d>=0&&a.charAt(d-e)===b.charAt(d-f);d--);return d-c+1};a.init=function(){b=this,e=b.undoLimit||e,b.addShortcut("ctrl+z",a.undo),b.addShortcut("ctrl+shift+z",a.redo),b.addShortcut("ctrl+y",a.redo),this.commands.undo||(b.commands.undo={exec:a.undo,txtExec:a.undo,tooltip:"Undo"}),this.commands.redo||(b.commands.redo={exec:a.redo,txtExec:a.redo,tooltip:"Redo"})},a.undo=function(){var a=g.pop(),c=b.val(null,!1);return a&&!f.length&&c===a.value&&(a=g.pop()),a&&(f.length||f.push({caret:b.sourceEditorCaret(),sourceMode:b.sourceMode(),value:c}),f.push(a),i(a)),!1},a.redo=function(){var a=f.pop();return g.length||(g.push(a),a=f.pop()),a&&(g.push(a),i(a)),!1},a.signalReady=function(){var c,a=b.val(null,!1);c=""===a?{end:0,start:0}:this.sourceEditorCaret(),d=a,g.push({caret:c,sourceMode:this.sourceMode(),value:a})},a.signalValuechangedEvent=function(a){var i=a.rawValue;e>0&&g.length>e&&g.shift(),!h&&d&&d!==i&&(f.length=0,c+=j(d,i),20>c||50>c&&!/\s$/g.test(a.rawValue)||(g.push({caret:b.sourceEditorCaret(),sourceMode:b.sourceMode(),value:i}),c=0,d=i))}}}(jQuery);
